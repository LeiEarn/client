<style lang="less">
  .weui-panel__hd {
    font-size: 12pt;
    color: black;
  }
</style>
<template>
  <view class="weui-panel weui-panel_access">
    <view class="weui-panel__hd">正在进行中的任务</view>
    <view class="ongoing">
      <ongoing :list="ongoing" />
    </view>
    <view class="weui-panel__hd">已完成的任务</view>
    <view class="comple">
      <complete :list="complete" />
    </view>
  </view>
</template>
<script>
  import wepy from 'wepy'
  import List from '../../components/list'
  export default class AcceptedTask extends wepy.page {
    config = {
      navigationBarTitleText: '已接受任务',
      navigationBarTextStyle: 'black',
      navigationBarBackgroundColor: '#E7E8E3',
      enablePullDownRefresh: true,
      backgroundTextStyle: 'dark',
      onReachBottomDistance: -300
    }
    components = {
      ongoing: List,
      complete: List
    }
    data = {
      ongoing: [{
        icon: '../../assets/background.jpg',
        title: '标题一',
        desc: '由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。',
        money: 0.5,
        left: 33
      },
      {
        icon: '../../assets/background.jpg',
        title: '标题二',
        desc: '由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。',
        money: 0.5,
        left: 20
      },
      {
        icon: '../../assets/background.jpg',
        title: '标题一',
        desc: '由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。',
        money: 0.5,
        left: 33
      },
      {
        icon: '../../assets/background.jpg',
        title: '标题二',
        desc: '由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。',
        money: 0.5,
        left: 20
      }
      ],
      complete: [{
        icon: '../../assets/background.jpg',
        title: '标题一',
        desc: '由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。',
        money: 0.5,
        left: 33
      }]
    }
    events = {}
    methods = {
      tap() {
        // this.num = this.num + 1
        console.log('65465448')
      },
      add() {
        let len = this.list.length
        this.list.push({
          id: len + 1,
          title: 'title_' + len
        })
      }
    }
    onLoad() {
      if (this.$parent.globalData.userId) {
        this.getReceivedTask()
      }
    }
    onPullDownRefresh() {
      console.log('下拉刷新列表')
      setTimeout(function() {
        this.getReceivedTask()
        wepy.stopPullDownRefresh()
      }, 5000)
    }
    getReceivedTask() {
      const rq = require('../../lib/request.js')
      let self = this
      this.userId = this.$parent.globalData.userId
      var object = {
        url: '/getReceivedTask',
        data: {
          userId: this.$parent.globalData.userId
        },
        method: 'GET'
      }
      rq.request(object).then(res => {
        self.ongoing = res.data.ongoing
        self.complete = res.data.complete
        self.$apply()
      })
    }
  }
</script>
